# MwalimuSmart - Setup Instructions

## Overview

MwalimuSmart has been successfully migrated from Supabase to a custom Node.js/Express backend with full Gemini AI integration. The application now features:

- **Custom Backend**: Node.js/Express server with Gemini AI SDK
- **Lesson Generation**: AI-powered step-by-step lesson creation
- **Visual Instructions**: Dynamic canvas drawings generated by Gemini AI
- **Audio Narration**: Text-to-speech using Web Speech API
- **No Supabase Dependency**: Complete independence from third-party backend services

## Prerequisites

- Node.js v18+ installed
- A Google Gemini API key ([Get one here](https://aistudio.google.com/app/apikey))

## Setup Instructions

### 1. Backend Setup

```bash
cd backend

# Create .env file from the example
cp .env.example .env

# Edit .env and add your Gemini API key
# GEMINI_API_KEY=your_actual_api_key_here
# PORT=3001
# FRONTEND_URL=http://localhost:5173

# Dependencies are already installed
# If needed, run: npm install

# Start the backend server
npm run dev
```

The backend server will start on `http://localhost:3001`

### 2. Frontend Setup

```bash
cd mvp-builder

# Dependencies are already installed
# If needed, run: npm install

# Start the frontend development server
npm run dev
```

The frontend will start on `http://localhost:5173`

## Usage

1. Open your browser and navigate to `http://localhost:5173`
2. Enter a question (e.g., "Explain photosynthesis")
3. Optionally upload an image for visual context
4. Click "Get Explanation"
5. On the Board page:
   - Click **Play** to start audio narration
   - Watch the canvas as visual illustrations appear
   - Use **Skip Forward/Back** to navigate between steps
   - Adjust volume with the slider

## Architecture Changes

### What Was Removed
- ✗ Supabase Edge Functions
- ✗ Supabase Client SDK
- ✗ Lovable AI Gateway proxy
- ✗ All Supabase environment variables

### What Was Added
- ✓ Custom Express backend (`/backend`)
- ✓ Direct Gemini AI SDK integration
- ✓ Visual instruction generation API
- ✓ Audio narration (Web Speech API)
- ✓ Canvas rendering with AI-generated drawings
- ✓ New API service layer in frontend

## API Endpoints

### Backend API (http://localhost:3001/api)

- `POST /api/generate-lesson` - Generate lesson from question
  ```json
  {
    "question": "string",
    "image": "base64_string (optional)"
  }
  ```

- `POST /api/generate-audio` - Generate audio narration
  ```json
  {
    "text": "string"
  }
  ```

- `POST /api/generate-visual` - Generate visual instructions
  ```json
  {
    "stepText": "string",
    "stepNumber": number
  }
  ```

## Troubleshooting

### Backend won't start
- Ensure you have a valid `GEMINI_API_KEY` in `backend/.env`
- Check that port 3001 is not already in use

### Frontend can't connect to backend
- Verify the backend is running on port 3001
- Check `VITE_BACKEND_URL` in `mvp-builder/.env` is set to `http://localhost:3001`

### Audio not playing
- Ensure your browser supports Web Speech API (Chrome, Edge, Safari)
- Check browser audio permissions

### Visuals not loading
- Check browser console for errors
- Verify backend is responding to `/api/generate-visual` requests

## Development

### Backend Development
```bash
cd backend
npm run dev  # Auto-reloads on file changes
```

### Frontend Development
```bash
cd mvp-builder
npm run dev  # Vite dev server with HMR
```

### Building for Production

Backend:
```bash
cd backend
npm run build
npm start
```

Frontend:
```bash
cd mvp-builder
npm run build
npm run preview
```

## Features

### Lesson Generation
- Powered by Gemini 2.0 Flash
- Structured JSON output with title, steps, and summary
- Support for image-based questions

### Visual Instructions
- AI-generated drawing commands (circles, rectangles, arrows, text, lines)
- Rendered on HTML5 canvas
- Synchronized with lesson steps

### Audio Narration
- Browser-native Web Speech API
- Adjustable volume
- Step-by-step playback
- Automatic progression through lesson

## Notes

- The backend uses Gemini 2.0 Flash Experimental for best performance
- Audio narration uses the browser's built-in TTS (no external API needed)
- Visual instructions are generated per step and cached
- All dependencies have been successfully installed
